# Руководство по балансу и инструментам дизайнера

Этот документ описывает новые настройки баланса, инструменты дебага и подход к тестированию, добавленные на фазе 6.

## Профили сложности

* **GameBalanceManager** автоматически поднимается из пресетов `GameBalanceProfileLibrary` и управляет глобальными множителями.
* Профили:
  * `Settler` — повышенный доход ресурсов, пониженный стресс, щадящая погода.
  * `Survivalist` — эталонные значения, близкие к RimWorld "Strive to Survive".
  * `Hardcore` — ужесточённая экономика, длинные штормы, агрессивные ментальные проверки.
* Настройки можно подстраивать во время плейтестов с помощью полей `economyOffset`, `storytellerOffset`, `weatherOffset`, `dayLengthOffset` на объекте `GameBalanceManager`.

### Графики потребностей

`GameBalanceProfile` использует `NeedSchedule`, чтобы моделировать суточные пики/спады давления потребностей. Это позволяет:

* Усилить голод и усталость в дневное время, чтобы заставить колонистов планировать расписание.
* Смещать восстановление стресса и медицинской помощи на вечерние слоты.

Профили можно расширять, добавляя новые `NeedScheduleMapping` с указанием часов и множителей (0–1).

## Storyteller и события

* `StorytellerDirector` использует `GameBalanceManager.SampleEventIntervalHours`, чтобы планировать события с экспоненциальным распределением и вариативностью.
* Все события проксируются в `EventConsole`, а также в существующий `EventLogUI`.
* Включите компонент `StorytellerDirector` в стартовой сцене для автоматической генерации нарратива.

## Погода и цикл дня

* `WeatherSystem` читает `RainWeatherDuration`/`ClearWeatherDuration` и `WeatherSeverityMultiplier`, чтобы менять продолжительность ливней, силу штрафа к скорости и альфа-канал оверлея.
* `DayNightCycle` использует `DayLengthMultiplier` для ускорения/замедления суток без правки исходного поля `minutesPerDay`.

## Ментальные состояния

* `Colonist` обращается к `GameBalanceManager.ShouldEnterMentalBreak`, чтобы динамически определять момент срыва.
* При срыве и восстановлении события фиксируются в `EventConsole`, что облегчает анализ причин.

## Инструменты дизайнера

* `DesignDebugOverlay` (клавиша F1) — виджет с текущим профилем сложности, ресурсами, погодой и последними событиями.
* `EventConsole` — центральный буфер (200 записей) для телеметрии. Можно подписаться на `EventConsole.EntryAdded` для собственных панелей.

## Тестирование

* Проект `Tests/Balance.Tests` содержит модульные тесты для `NeedSchedule` и `GameBalanceProfile`.
* Запуск: `dotnet test Tests/Balance.Tests/Balance.Tests.csproj`
* Тесты не требуют Unity и могут выполняться в CI.

## Рекомендации по расширению

1. Добавляйте новые события storyteller'а через шаблоны в `StorytellerDirector`.
2. Расширяйте `GameBalanceProfileLibrary` особыми биомными профилями, используя существующие `NeedSchedule`.
3. Для диагностики создавайте собственные слушатели `EventConsole.EntryAdded` и визуализируйте данные в UI.
